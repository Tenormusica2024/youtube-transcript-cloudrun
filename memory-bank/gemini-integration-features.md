# Gemini AI統合機能詳細

## 実装された機能

### 1. 自動テキスト整形機能
- **関数**: `format_text_with_gemini(text)`
- **モデル**: gemini-2.0-flash-001
- **目的**: YouTube字幕テキストを読みやすく整形

#### 整形ルール:
1. **句点後の空行**: 各文（。で終わる文）の後に必ず空行を挿入（改行2回）
2. **話題転換**: 話題が変わる箇所でさらに空行を追加
3. **接続詞前**: 「で、」「それで、」「そして、」などの前で空行
4. **長文改行**: 読点（、）の位置で適切に改行
5. **文字保持**: 一切の文字・単語の変更・追加・削除禁止

#### プロンプト例:
```
以下のYouTube字幕テキストを読みやすく整形してください。

【重要な制約】:
- 文字や単語を一切変更・追加・削除しないでください
- 内容の要約や意訳は絶対に行わないでください
- 元のテキストの文字をそのまま保持してください

【整形作業】:
1. 各文（。で終わる文）の後には必ず空行を入れてください（改行2回）
2. つまり、句点の後は必ず空行で区切ってください
3. 話題が変わる箇所ではさらに空行を追加してください
4. 「で、」「それで、」「そして、」などの接続詞の前でも空行を入れてください
5. 長い文は読点（、）の位置で改行してください
6. 読みやすさを最優先に、空行を多めに使ってください
```

### 2. 詳細要約機能
- **関数**: `summarize_with_gemini(text)`
- **モデル**: gemini-2.0-flash-001
- **目的**: 500-800文字の詳細な要約を生成

#### 要約特徴:
1. **情報保持**: 重要な情報は全て保持
2. **要点数**: 5〜10個の要点に整理
3. **固有名詞**: 数値、専門用語を必ず含める
4. **具体例**: 重要な具体例や説明も保持
5. **文字数**: 500〜800文字程度

#### 整形ルール:
1. **箇条書き**: 「・」や「◆」で要点を開始
2. **段落化**: 関連内容をグループ化
3. **キーワード強調**: 【】で重要キーワードを囲む
4. **空行**: 各段落間に空行挿入
5. **改行**: 読みやすさ重視の改行

#### プロンプト例:
```
以下のYouTube動画の字幕テキストを詳細に要約してください。

【要約の要求】:
1. 重要な情報は全て残してください
2. 主要なトピックを5〜10個の要点に整理してください
3. 固有名詞、数値、専門用語は必ず含めてください
4. 具体的な例や説明も重要なものは残してください
5. 500〜800文字程度でまとめてください

【整形ルール】:
1. 各要点は「・」や「◆」で始めてください
2. 関連する内容は段落でグループ化してください
3. 重要なキーワードは【】で囲んでください
4. 各段落の間には空行を入れてください
5. 読みやすさを重視して改行を使ってください
```

## APIパラメータ設定

### 整形用設定
```python
config=types.GenerateContentConfig(
    temperature=0.1,        # 低温度で一貫性を重視
    max_output_tokens=2000, # 十分な出力長
)
```

### 要約用設定
```python
config=types.GenerateContentConfig(
    temperature=0.3,        # やや創造性を許可
    max_output_tokens=1200, # 要約に適した長さ
)
```

## 自動実行フロー

1. **テキスト形式選択時のみ自動実行**
2. **字幕抽出** → **自動整形** → **自動要約**
3. **エラー処理**: API失敗時は元テキストを使用
4. **ログ記録**: 成功・失敗を詳細ログ

## UI統合

### 整形テキスト表示
- **ラベル**: "字幕テキスト（AI整形済み）"
- **高さ**: 300px
- **フォント**: monospace

### 要約テキスト表示
- **ラベル**: "詳細な要約"
- **高さ**: 250px
- **背景色**: #f0f8ff (薄い青)
- **フォントサイズ**: 14px
- **行間**: 1.6

## エラーハンドリング

1. **Gemini API未初期化**: 元テキスト使用、警告ログ
2. **API呼び出し失敗**: 元テキスト使用、エラーログ
3. **要約失敗**: 空文字列返却、エラーログ
4. **ネットワークエラー**: 適切なフォールバック処理